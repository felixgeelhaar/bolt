{{/*
Bolt Monitoring Stack - Installation Notes
*/}}

🚀 Bolt Logging Library Monitoring Stack has been deployed!

{{- if .Values.boltApp.enabled }}
🎯 Bolt Application:
{{- if .Values.boltApp.ingress.enabled }}
{{- range .Values.boltApp.ingress.hosts }}
  - Application: {{ $.Values.global.protocol }}://{{ .host }}
{{- end }}
{{- else }}
  - Application: http://{{ include "bolt-monitoring.fullname" . }}-bolt-app:{{ .Values.boltApp.service.port }}
{{- end }}
  - Metrics Endpoint: {{ $.Values.global.protocol }}://{{ (index .Values.boltApp.ingress.hosts 0).host }}/metrics
  - Health Check: {{ $.Values.global.protocol }}://{{ (index .Values.boltApp.ingress.hosts 0).host }}/health
{{- end }}

{{- if .Values.prometheus.enabled }}
📊 Prometheus:
{{- if .Values.prometheus.server.ingress.enabled }}
  - Web UI: {{ $.Values.global.protocol }}://{{ (index .Values.prometheus.server.ingress.hosts 0).host }}
{{- else }}
  - Web UI: http://prometheus-server:{{ .Values.prometheus.server.service.port }}
{{- end }}
  - Metrics Collection: Every {{ .Values.prometheus.server.config.global.scrape_interval }}
  - Retention: {{ .Values.prometheus.server.retention }}
{{- end }}

{{- if .Values.grafana.enabled }}
📈 Grafana Dashboards:
{{- if .Values.grafana.ingress.enabled }}
  - Dashboard UI: {{ $.Values.global.protocol }}://{{ (index .Values.grafana.ingress.hosts 0).host }}
{{- else }}
  - Dashboard UI: http://grafana:{{ .Values.grafana.service.port }}
{{- end }}
  - Username: admin
  - Password: Retrieved from secret 'grafana-admin-secret'
  
  Available Dashboards:
  - 🎯 Bolt Performance Overview: Real-time performance metrics
  - 🏥 Bolt Operational Health: System health monitoring
{{- end }}

{{- if .Values.jaeger.enabled }}
🔍 Jaeger Tracing:
{{- if .Values.jaeger.allInOne.ingress.enabled }}
  - Tracing UI: {{ $.Values.global.protocol }}://{{ (index .Values.jaeger.allInOne.ingress.hosts 0).host }}
{{- else }}
  - Tracing UI: http://jaeger:16686
{{- end }}
  - Collector Endpoint: http://jaeger:14268/api/traces
  - Sampling Rate: {{ (index .Values.jaeger.allInOne.env 4).value }}
{{- end }}

{{- if .Values.alertmanager.enabled }}
🚨 AlertManager:
{{- if .Values.alertmanager.ingress.enabled }}
  - Alert Management: {{ $.Values.global.protocol }}://{{ (index .Values.alertmanager.ingress.hosts 0).host }}
{{- else }}
  - Alert Management: http://alertmanager:{{ .Values.alertmanager.service.port }}
{{- end }}
  - Replicas: {{ .Values.alertmanager.replicaCount }}
  - Critical Alerts: Configured for Slack and PagerDuty
{{- end }}

{{- if .Values.kibana.enabled }}
🔎 Kibana Logs:
{{- if .Values.kibana.ingress.enabled }}
  - Log Analysis: {{ $.Values.global.protocol }}://{{ (index .Values.kibana.ingress.hosts 0).host }}
{{- else }}
  - Log Analysis: http://kibana:{{ .Values.kibana.service.port }}
{{- end }}
  - Index Pattern: bolt-logs-*
{{- end }}

⚡ Performance Targets:
  - Logging Latency: < 100μs (p95)
  - Zero Allocations: ✅ Enforced
  - Throughput: > 1M logs/second
  - Error Rate: < 1%

🔧 Monitoring Features:
{{- if .Values.boltApp.autoscaling.enabled }}
  - ✅ Auto-scaling: {{ .Values.boltApp.autoscaling.minReplicas }} - {{ .Values.boltApp.autoscaling.maxReplicas }} replicas
{{- end }}
{{- if .Values.security.networkPolicies.enabled }}
  - ✅ Network Security: Policies enforced
{{- end }}
{{- if .Values.security.podSecurityPolicy.enabled }}
  - ✅ Pod Security: Non-root containers required
{{- end }}
{{- if .Values.backup.enabled }}
  - ✅ Backup: Daily at 2 AM ({{ .Values.backup.retention }} retention)
{{- end }}

🎛️ Getting Started:

1. Access Grafana Dashboard:
   kubectl get secret grafana-admin-secret -o jsonpath="{.data.admin-password}" | base64 --decode
   
2. Check Application Health:
   kubectl get pods -l app.kubernetes.io/name=bolt-app
   
3. View Real-time Metrics:
   kubectl port-forward svc/prometheus-server 9090:9090
   
4. Monitor Logs:
   kubectl logs -l app.kubernetes.io/name=bolt-app -f

📊 Key Metrics to Monitor:
  - bolt_logging_duration_seconds_bucket (Latency SLA)
  - bolt_allocation_count_total (Zero-allocation compliance)
  - bolt_log_events_total (Throughput)
  - bolt_logging_errors_total (Error rate)
  - bolt_event_pool_available_events (Resource efficiency)

🚨 Critical Alerts Configured:
  - BoltLoggingLatencyHigh: > 100μs (p95)
  - BoltUnexpectedAllocations: Any memory allocations
  - BoltEventPoolExhaustion: < 10 available events
  - BoltLoggingErrorRateCritical: > 5% error rate

🔍 Troubleshooting:

  Check pod status:
    kubectl get pods -n {{ .Release.Namespace }}
  
  View service endpoints:
    kubectl get svc -n {{ .Release.Namespace }}
  
  Check ingress configuration:
    kubectl get ingress -n {{ .Release.Namespace }}
  
  Monitor resource usage:
    kubectl top pods -n {{ .Release.Namespace }}

📚 Documentation:
  - Bolt Library: https://github.com/bolt-org/bolt
  - Performance Guide: https://bolt-logging.org/performance
  - Monitoring Runbooks: https://bolt-logging.org/runbooks
  - API Reference: https://bolt-logging.org/api

{{- if .Values.testing.enabled }}

🧪 Testing:
  Run smoke tests:
    kubectl create job --from=cronjob/smoke-test smoke-test-manual
  
  Run performance tests:
    kubectl create job --from=cronjob/performance-test perf-test-manual
  
  Run load tests:
    kubectl create job --from=cronjob/load-test load-test-manual
{{- end }}

💡 Pro Tips:
  - Use Grafana alerts for proactive monitoring
  - Set up Slack/PagerDuty integrations for critical alerts  
  - Monitor the zero-allocation compliance dashboard closely
  - Use Jaeger to trace performance bottlenecks
  - Regular backup verification is recommended

🏆 Bolt achieves industry-leading performance:
  - 62.96ns/op with zero allocations
  - 64% faster than similar logging libraries
  - Production-ready reliability and monitoring

Happy monitoring! 🎉